<!--页面标题-->
<div class="nav-title">
  <a><h4>优惠信息管理</h4></a>
  <div class="b-head-right">
    <div class="content-box" tabindex="0" (click)="back()">
      <i class="icon-reload"></i> 返回
    </div>
  </div>
</div>
<!--搜索栏-->
<div class="search-bar">
  <ul>
    <li><label>商品名称</label>
      <input type="text" name="search" [(ngModel)]="search">
      <a (click)="getDiscount(1);"><i class="icon-magnifier"></i>查询</a>
    </li>
    <li>
        <a class="btn-danger"
           (click)="fadeBom()">
          <i class="icon-plus"></i>
          添加
        </a>
    </li>
  </ul>
</div>
<!--表头-->
<div class="table-head" style="margin-top: 10px">
  <table border="0" cellspacing="0" cellpadding="0" class="list-box">
    <tr class="row list-title" style="height:45px;">
      <th width="10%" class="text-left">标题</th>
      <th width="25%" class="text-left">内容介绍</th>
      <th width="20%">图片</th>
      <th width="20%">优惠有效期</th>
      <th width="10%">状态</th>
      <th width="15%">操作</th>
    </tr>
  </table>
</div>
<!--表格内容-->
<div class="table-content" style="min-height: 500px">
  <table border="0" cellspacing="0" cellpadding="0" class="list-box">
    <tr class="row"  style="height:100px;" *ngFor="let discount of discounts;let i = index">
      <td width="10%" class="text-left">
        <span>
          {{discount.title}}
        </span>
      </td>
      <td width="25%" class="text-left">
        <p class="tb-text">
          {{discount.summary}}
        </p>
      </td>
      <td width="20%" class="box-demo">
        <img *ngIf="discount.imgPathList"
             [src]="ipSetting.imgUrl+discount.imgPathList[0]">
      </td>
      <td width="20%">
        <span>
          {{discount.effectBtime+" - "+discount.effectEtime}}
        </span>
      </td>
      <td width="10%" [ngStyle]="{'color':discount.status === '失效'?'red':'green'}">
        {{discount.status}}
      </td>
      <td width="15%" class="box-option">
        <a (click)="linkDetail(discount.id)">
          <i class="icon-screen-desktop"></i>详情
        </a>
        <a (click)="onEdit(discount.id)">
          <!--<a (click)="edit(discount)">-->
          <i class="icon-pencil"></i>编辑
        </a>
        <a (click)="delete(discount.id)">
          <i class="icon-trash"></i>删除
        </a>
      </td>
    </tr>
  </table>
  <div class="div-none" *ngIf="discounts&&discounts.length < 1">
    <p>暂无信息</p>
  </div>
</div>
<!--翻页-->
<app-turn-bar
  [pageNo] = "pageNo"
  [pageSize] = "pageSize"
  [total] = "total"
  (turnEvent) = "getDiscount($event)">
</app-turn-bar>

<!--新建-->
<div class="mask" style="display: none;">
  <div  class="modal-content">
    <div  class="modal-header">
      <h4 class="modal-title"><i class="icon-home"></i>{{navtitle}}优惠信息</h4>
      <button class="modal-close" type="button" (click)="closeMask()">×</button>
    </div>
    <form  class="form-building form-material ng-untouched ng-pristine ng-valid" novalidate="">
      <div  class="modal-body clearfix">
        <div class="modal-left">
          <div class="dropify-title">商品图片</div>
          <div  class="dropify-wrapper">
            <div  class="dropify-message">
              <img *ngIf="imgUrl&&imgUrl[0]&&imgUrl[0].length>0" [src]="ipSetting.imgUrl+imgUrl[0]">
              <!--<img *ngIf="open&&copyDiscount.imgPathList[0]" [src]="copyDiscount.imgPathList[0] | imgsafeurl:prese1.files" />-->
            </div>
            <p style="font-size: 12px;">点击添加图片</p>
            <input  class="dropify" type="file"  id="prese1"
                    #prese1
                    (change)="prese_upload(prese1.files,0)">
          </div>
          <div  class="dropify-wrapper">
            <div  class="dropify-message">
              <img *ngIf="imgUrl&&imgUrl[1]&&imgUrl[1].length>0"  [src]="ipSetting.imgUrl+imgUrl[1]">
            </div>
            <p style="font-size: 12px;">点击添加图片</p>
            <input  class="dropify" type="file"  id="prese2"
                    #prese2
                    (change)="prese_upload(prese2.files,1)">
          </div>
          <div  class="dropify-wrapper">
            <div  class="dropify-message">
              <img *ngIf="imgUrl&&imgUrl[2]&&imgUrl[2].length>0"  [src]="ipSetting.imgUrl+imgUrl[2]">
            </div>
            <p style="font-size: 12px;">点击添加图片</p>
            <input  class="dropify" type="file"  id="prese3"
                    #prese3
                    (change)="prese_upload(prese3.files,2)">
          </div>

          <div class="dropify-title">详情图片</div>
          <div class="dropify-wrapper" *ngFor="let img of imgInfo;let i = index">
            <a class="top-trash" title="删除图片" (click)="delImgPath(i)">x</a>
            <div  class="dropify-message">
              <img [src]="ipSetting.imgUrl+img" *ngIf="img">
            </div>
          </div>
          <div  class="dropify-wrapper bpt" *ngIf="imgInfo&&imgInfo.length<6">
            <div  class="dropify-message"></div>
            <p style="font-size: 12px;">点击上传图片</p>
            <input  class="dropify" type="file"  id="press" #press
                    (change)="prese_uploadInfo(press.files)">
          </div>
          <div class="dropify-file">
            <a class="btn-danger">上传附件</a>
            <input  class="dropify" type="file"  id="presefile"
                    #presefile
                    (change)="prese_uploadFile(presefile.files)">
          </div>
          <div class="file-message">
            <p *ngFor="let fileName of copyDiscount.fileName;let i =index">
              {{fileName}}
              <a class="btn-close" (click)="delfile(i)">
                <i class="icon-close"></i>
              </a>
            </p>
          </div>
        </div>
        <div  class="modal-right">
          <div  class="form-group">
            <label  class="control-label"><span>标题</span>
              <input class="form-control" id="title"
                     name="title" placeholder="" type="text"
                     [(ngModel)]="copyDiscount.title"
                     (blur)="verifyEmpty(copyDiscount.title,'title')"
                     >
            </label>
            <div class="error"></div>
          </div>
          <div  class="form-group">
            <label  class="control-label"><span>内容介绍</span>
              <textarea class="form-control" id="summary" name="summary" style="line-height: 20px;height: 80px;"
                        [(ngModel)]="copyDiscount.summary"
                        (blur)="verifyEmpty(copyDiscount.summary,'summary')"
              ></textarea>
            </label>
            <div class="error"></div>
          </div>
          <div  class="form-group">
            <label  class="control-label">
              <span>优惠有效期</span>
              <input class="form-control" type="date"
                     id="effectBtime" name="effectBtime"
                     placeholder=""
                     [(ngModel)]="copyDiscount.effectBtime"
                     (blur)="verifyEmpty(copyDiscount.effectBtime,'effectBtime')"
              >至
              <input class="form-control" type="date"
                     id="effectEtime" name="effectEtime"
                     placeholder=""
                     [(ngModel)]="copyDiscount.effectEtime"
                     (blur)="verifyEmpty(copyDiscount.effectEtime,'effectEtime')"
              >
            </label>
            <div class="error"></div>
          </div>
          <div  class="form-group" *ngFor="let other of tempOther;let i = index;">
            <label  class="control-label" *ngIf="other.isShow">
              <input class="form-title" type="text"
                     [name]="'otherKey'+i" [(ngModel)]="other.key">
              <input class="form-control" type="text"
                     [name]="'otherValue'+i" [(ngModel)]="other.value">
              <a class="btn-close" (click)="delLine(i)">
                <i class="icon-close"></i>
              </a>
            </label>
            <div class="error"></div>
          </div>
          <div class="opt-other">
            <a class="btn-add" (click)="addLine()">
              <i class="icon-plus"></i>
              添加自定义字段
            </a>
          </div>
        </div>
      </div>
      <div  class="modal-footer">
        <button  class="btn btn-info" type="submit"
                 (click)="submit()">保 存</button>
        <button  class="btn btn-danger" type="button"
                 (click)="closeMask()">取 消</button>
      </div>
    </form>
  </div>
</div>
